<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ABM Automation Tool</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    import { useState, useRef, useEffect } from "react";

// â”€â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const STAGES = [
  { id: "snapshot",    label: "Account Snapshot",        icon: "ğŸ¢", color: "#3B82F6" },
  { id: "entity",      label: "AI / Tech Entity",         icon: "ğŸ¤–", color: "#8B5CF6" },
  { id: "stack",       label: "Technology Stack",         icon: "âš™ï¸",  color: "#06B6D4" },
  { id: "stakeholders",label: "Buying Group",             icon: "ğŸ‘¥", color: "#10B981" },
  { id: "signals",     label: "Buying Signals",           icon: "ğŸ“¡", color: "#F59E0B" },
  { id: "pains",       label: "Business Pains & AWS",     icon: "ğŸ¯", color: "#EF4444" },
  { id: "competitive", label: "Competitive Landscape",    icon: "âš”ï¸",  color: "#EC4899" },
  { id: "action",      label: "3-Week Action Plan",       icon: "ğŸš€", color: "#F97316" },
  { id: "outreach",    label: "Outreach Emails",          icon: "âœ‰ï¸",  color: "#14B8A6" },
];

const SYSTEM_PROMPT = `You are an elite B2B account intelligence researcher for Younion Ã— AWS. 
You build Account Intelligence Profiles (AIPs) for enterprise sales teams.
Your research is precise, sourced, and actionable. You write in clear human language â€” not jargon.
Every claim must be based on verifiable information. Flag uncertainty explicitly.
Format all responses as clean JSON only â€” no markdown, no preamble, no explanation outside the JSON.`;

const STAGE_PROMPTS = {
  snapshot: (company, url) => `Research this company and return ONLY valid JSON:
Company: ${company}
Website: ${url}

Return this exact JSON structure (fill every field with real researched data):
{
  "legalEntities": "List all main legal entities and what each covers",
  "recentStructure": "Any demergers, mergers, spin-offs, restructuring in last 2 years",
  "revenue": "Latest annual revenue with currency and fiscal year",
  "ebitda": "Latest EBITDA figure",
  "debtStatus": "Debt-free / debt level",
  "segments": "Revenue breakdown by business segment with percentages",
  "employees": "Total employee count",
  "hqAndPlants": "HQ location and major manufacturing/office locations",
  "globalFootprint": "Countries of operation and subsidiaries count",
  "digitalMaturity": "HIGH/MEDIUM/LOW with evidence â€” cloud usage, tech team, digital initiatives",
  "keyFacts": ["3-5 most important facts about this company right now"],
  "sources": ["url1", "url2", "url3"]
}`,

  entity: (company, url) => `Research whether ${company} (${url}) has created any dedicated AI, data, digital transformation, or technology subsidiary or division.
Return ONLY valid JSON:
{
  "exists": true or false,
  "entityName": "Full legal name if exists, null if not",
  "incorporated": "Date and location if exists",
  "cin": "Company registration number if applicable",
  "ceo": "Name and background",
  "cto": "Name and their stated focus/philosophy",
  "coreFocus": ["list of focus areas"],
  "capitalStatus": "Authorized vs paid-up capital, funding stage",
  "vendorDealsOnRecord": "Any publicly announced technology partnerships or vendor deals",
  "urgencyNote": "Is the platform decision window open or closed? Why?",
  "sources": ["url1", "url2"]
}`,

  stack: (company, url) => `Research the technology stack, cloud infrastructure, and software vendors used by ${company} (${url}).
Return ONLY valid JSON:
{
  "stack": [
    {
      "layer": "e.g. Primary Cloud",
      "vendor": "Vendor name",
      "useCase": "What they use it for",
      "depth": "DEEP/MODERATE/LIGHT â€” how embedded is this vendor",
      "notes": "Key details, awards, certifications",
      "source": "url or document name"
    }
  ],
  "primaryCloud": "AWS / Azure / GCP / On-Prem / Hybrid",
  "cloudDepth": "How deeply is AWS already embedded?",
  "keyPartners": "Main SIs â€” TCS, Infosys, Wipro etc",
  "openOpportunities": "Where is the stack incomplete or ripe for extension?",
  "sources": ["url1", "url2"]
}`,

  stakeholders: (company, url) => `Identify the buying group and key stakeholders at ${company} (${url}) for a technology/cloud deal.
Return ONLY valid JSON:
{
  "stakeholders": [
    {
      "role": "Economic Buyer / Champion / Influencer / Technical Evaluator / End User",
      "name": "Full name and title â€” use 'Not identified' if unknown",
      "linkedIn": "LinkedIn URL if found",
      "influenceArea": "What decisions they influence",
      "howToEngage": "Specific engagement strategy for this person",
      "priority": "HIGH/MEDIUM/LOW"
    }
  ],
  "entryPoint": "Who to call first and why",
  "warmIntroPath": "Which partner or network connection could make an introduction?",
  "sources": ["url1", "url2"]
}`,

  signals: (company, url) => `Identify all active buying signals at ${company} (${url}) that suggest urgency to engage NOW for a cloud/AI deal.
Return ONLY valid JSON:
{
  "signals": [
    {
      "priority": "RED / ORANGE / YELLOW",
      "signal": "Short signal name",
      "detail": "2-3 sentences explaining what happened and why it matters for us",
      "actionRequired": "Exactly what our team should do because of this signal",
      "timeWindow": "This week / This month / This quarter / Ongoing",
      "source": "url or document"
    }
  ],
  "overallUrgency": "HIGH / MEDIUM / LOW",
  "urgencySummary": "1-2 sentences on why now is the right time to engage",
  "sources": ["url1", "url2"]
}`,

  pains: (company, url) => `Identify the top 4-5 specific, verifiable business pains at ${company} (${url}) and map each to concrete AWS solutions.
Return ONLY valid JSON:
{
  "pains": [
    {
      "area": "Pain area name (e.g. EV Battery Analytics)",
      "pain": "2-3 sentences: what is happening, why it hurts, what they are missing. Use specific numbers and dates. No generic statements.",
      "awsAnswer": "Specific AWS services and what outcome they deliver for this exact pain. Be concrete â€” name the services.",
      "urgency": "CRITICAL / HIGH / MEDIUM",
      "revenueImpact": "Estimated $ or % impact if you can find it",
      "source": "url or document name"
    }
  ],
  "biggestWin": "Which single pain represents the fastest path to a deal and why?",
  "pocSuggestion": "Suggest a specific 30-day Proof of Concept with a clear deliverable",
  "sources": ["url1", "url2"]
}`,

  competitive: (company, url) => `Map the competitive technology landscape at ${company} (${url}) â€” who is already embedded, what they do, and how AWS should respond.
Return ONLY valid JSON:
{
  "competitors": [
    {
      "vendor": "Vendor name",
      "currentSituation": "What are they doing at this account right now? How embedded?",
      "threatLevel": "HIGH / MEDIUM / LOW / PARTNER",
      "ourPlay": "Specific AWS response strategy â€” displace / co-exist / co-sell / extend",
      "source": "url"
    }
  ],
  "biggestThreat": "Which competitor is most dangerous and why",
  "biggestAlly": "Which vendor could be a co-sell partner",
  "sources": ["url1", "url2"]
}`,

  action: (company, url, previousData) => `Based on all research for ${company} (${url}), create a specific 3-week action plan.
Context summary: ${previousData}
Return ONLY valid JSON:
{
  "weeks": [
    {
      "week": "Week 1 â€” Days 1-7",
      "theme": "Short theme name",
      "actions": [
        {
          "action": "Specific action description",
          "owner": "AE / SDR / Marketing / Solutions Engineering / Channel",
          "day": "Day 1 / Day 2-3 / By end of week",
          "priority": "MUST DO / SHOULD DO"
        }
      ]
    },
    {
      "week": "Week 2 â€” Days 8-14",
      "theme": "Short theme name",
      "actions": []
    },
    {
      "week": "Week 3 â€” Days 15-21",
      "theme": "Short theme name",
      "actions": []
    }
  ],
  "expectedOutcome": "What should we have achieved by end of Week 3?",
  "dealTimeline": "Realistic timeline from first meeting to closed deal"
}`,

  outreach: (company, url, previousData) => `Write personalised outreach messages for ${company} (${url}) based on this research: ${previousData}

Return ONLY valid JSON:
{
  "emails": [
    {
      "target": "Role name (e.g. CEO of AI subsidiary)",
      "name": "Person's name if known, else role",
      "subject": "Email subject line",
      "body": "Full email body â€” 150-200 words. Reference specific company facts. Do not use generic AI language. Sound like a thoughtful human who has done their homework.",
      "tone": "Strategic / Technical / Urgency-led"
    }
  ],
  "linkedInMessages": [
    {
      "target": "Role name",
      "message": "LinkedIn connection message â€” max 300 characters. Specific, not generic."
    }
  ],
  "coldCallOpener": "One sentence that would make the right person want to keep listening. Reference a specific recent event at the company."
}`
};

// â”€â”€â”€ API CALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function callClaude(prompt, previousContext = "") {
  const fullPrompt = previousContext
    ? `${prompt}\n\nPrevious research context:\n${previousContext}`
    : prompt;

  const response = await fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1000,
      system: SYSTEM_PROMPT,
      tools: [{ type: "web_search_20250305", name: "web_search" }],
      messages: [{ role: "user", content: fullPrompt }]
    })
  });

  const data = await response.json();
  const text = data.content
    .filter(b => b.type === "text")
    .map(b => b.text)
    .join("");

  try {
    const clean = text.replace(/```json\n?|```\n?/g, "").trim();
    const jsonStart = clean.indexOf("{");
    const jsonEnd = clean.lastIndexOf("}");
    if (jsonStart !== -1 && jsonEnd !== -1) {
      return JSON.parse(clean.slice(jsonStart, jsonEnd + 1));
    }
    return { raw: text };
  } catch {
    return { raw: text };
  }
}

// â”€â”€â”€ COMPONENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const PriorityBadge = ({ priority }) => {
  const cfg = {
    RED:      { bg: "#FEE2E2", color: "#991B1B", dot: "#EF4444", label: "ğŸ”´ Act Now" },
    ORANGE:   { bg: "#FEF3C7", color: "#92400E", dot: "#F59E0B", label: "ğŸŸ  This Month" },
    YELLOW:   { bg: "#FEF9C3", color: "#713F12", dot: "#EAB308", label: "ğŸŸ¡ Monitor" },
    CRITICAL: { bg: "#FEE2E2", color: "#991B1B", dot: "#EF4444", label: "Critical" },
    HIGH:     { bg: "#FEF3C7", color: "#92400E", dot: "#F59E0B", label: "High" },
    MEDIUM:   { bg: "#ECFDF5", color: "#065F46", dot: "#10B981", label: "Medium" },
    LOW:      { bg: "#F1F5F9", color: "#475569", dot: "#94A3B8", label: "Low" },
    PARTNER:  { bg: "#EFF6FF", color: "#1E40AF", dot: "#3B82F6", label: "Partner" },
  };
  const c = cfg[priority] || cfg.MEDIUM;
  return (
    <span style={{ background: c.bg, color: c.color, padding: "2px 8px", borderRadius: 9999, fontSize: 11, fontWeight: 700, fontFamily: "monospace", letterSpacing: 0.5 }}>
      {c.label}
    </span>
  );
};

const Card = ({ children, style = {} }) => (
  <div style={{ background: "#FFFFFF", border: "1px solid #E2E8F0", borderRadius: 12, padding: "20px 24px", marginBottom: 16, boxShadow: "0 1px 3px rgba(0,0,0,0.05)", ...style }}>
    {children}
  </div>
);

const SectionLabel = ({ color, children }) => (
  <div style={{ display: "inline-flex", alignItems: "center", gap: 6, background: color + "18", color, padding: "3px 10px", borderRadius: 6, fontSize: 11, fontWeight: 800, letterSpacing: 1, textTransform: "uppercase", marginBottom: 12 }}>
    {children}
  </div>
);

const StackRow = ({ item, i }) => (
  <div style={{ display: "grid", gridTemplateColumns: "160px 180px 1fr 100px", gap: 12, padding: "10px 14px", background: i % 2 === 0 ? "#F8FAFC" : "#FFFFFF", borderBottom: "1px solid #F1F5F9", fontSize: 13 }}>
    <div style={{ fontWeight: 700, color: "#3B82F6" }}>{item.layer}</div>
    <div style={{ fontWeight: 600, color: "#1E293B" }}>{item.vendor}</div>
    <div style={{ color: "#475569" }}>{item.useCase}</div>
    <PriorityBadge priority={item.depth === "DEEP" ? "HIGH" : item.depth === "MODERATE" ? "MEDIUM" : "LOW"} />
  </div>
);

const SignalCard = ({ signal }) => {
  const colors = { RED: "#EF4444", ORANGE: "#F59E0B", YELLOW: "#EAB308" };
  const bgs = { RED: "#FEF2F2", ORANGE: "#FFFBEB", YELLOW: "#FEFCE8" };
  const c = colors[signal.priority] || "#94A3B8";
  const bg = bgs[signal.priority] || "#F8FAFC";
  return (
    <div style={{ border: `2px solid ${c}30`, borderLeft: `4px solid ${c}`, borderRadius: 10, padding: "14px 18px", marginBottom: 10, background: bg }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 8 }}>
        <span style={{ fontWeight: 800, fontSize: 14, color: "#0F172A" }}>{signal.signal}</span>
        <PriorityBadge priority={signal.priority} />
      </div>
      <p style={{ margin: "0 0 8px", fontSize: 13, color: "#475569", lineHeight: 1.6 }}>{signal.detail}</p>
      <div style={{ background: "#FFFFFF80", border: `1px solid ${c}30`, borderRadius: 6, padding: "8px 12px", fontSize: 12 }}>
        <span style={{ fontWeight: 700, color: c }}>â†’ Action: </span>
        <span style={{ color: "#1E293B" }}>{signal.actionRequired}</span>
      </div>
      {signal.source && (
        <div style={{ marginTop: 6, fontSize: 11, color: "#94A3B8" }}>ğŸ“ {signal.source}</div>
      )}
    </div>
  );
};

const PainCard = ({ pain }) => (
  <div style={{ border: "1px solid #E2E8F0", borderRadius: 12, overflow: "hidden", marginBottom: 14 }}>
    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr" }}>
      <div style={{ padding: "16px 18px", borderRight: "1px solid #E2E8F0" }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
          <SectionLabel color="#EF4444">Pain</SectionLabel>
          <PriorityBadge priority={pain.urgency} />
        </div>
        <p style={{ margin: 0, fontSize: 13, color: "#374151", lineHeight: 1.65 }}>{pain.pain}</p>
        {pain.revenueImpact && pain.revenueImpact !== "Not found" && (
          <div style={{ marginTop: 10, fontSize: 12, color: "#6B7280", fontStyle: "italic" }}>ğŸ’° {pain.revenueImpact}</div>
        )}
      </div>
      <div style={{ padding: "16px 18px", background: "#F0FDF4" }}>
        <SectionLabel color="#10B981">AWS Answer</SectionLabel>
        <p style={{ margin: 0, fontSize: 13, color: "#1E293B", lineHeight: 1.65 }}>{pain.awsAnswer}</p>
        {pain.source && (
          <div style={{ marginTop: 10, fontSize: 11, color: "#94A3B8" }}>ğŸ“ {pain.source}</div>
        )}
      </div>
    </div>
  </div>
);

const EmailCard = ({ email }) => {
  const [copied, setCopied] = useState(false);
  const copy = () => {
    navigator.clipboard.writeText(`Subject: ${email.subject}\n\n${email.body}`);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };
  return (
    <Card>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14 }}>
        <div>
          <div style={{ fontWeight: 800, fontSize: 15, color: "#0F172A" }}>{email.target}</div>
          <div style={{ fontSize: 12, color: "#94A3B8", marginTop: 2 }}>{email.name !== email.target ? email.name : ""}</div>
        </div>
        <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
          <span style={{ fontSize: 11, background: "#EFF6FF", color: "#3B82F6", padding: "3px 8px", borderRadius: 6, fontWeight: 600 }}>{email.tone}</span>
          <button onClick={copy} style={{ cursor: "pointer", background: copied ? "#DCFCE7" : "#F1F5F9", color: copied ? "#166534" : "#64748B", border: "none", padding: "6px 12px", borderRadius: 8, fontSize: 12, fontWeight: 700 }}>
            {copied ? "âœ“ Copied" : "Copy"}
          </button>
        </div>
      </div>
      <div style={{ background: "#F8FAFC", border: "1px solid #E2E8F0", borderRadius: 8, padding: 14 }}>
        <div style={{ fontSize: 12, fontWeight: 700, color: "#64748B", marginBottom: 6 }}>Subject: {email.subject}</div>
        <div style={{ fontSize: 13, color: "#374151", lineHeight: 1.75, whiteSpace: "pre-line" }}>{email.body}</div>
      </div>
    </Card>
  );
};

const LinkedInCard = ({ msg }) => {
  const [copied, setCopied] = useState(false);
  const charCount = msg.message?.length || 0;
  return (
    <Card style={{ background: "#EFF6FF" }}>
      <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 10 }}>
        <span style={{ fontWeight: 700, color: "#1E40AF", fontSize: 14 }}>{msg.target}</span>
        <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
          <span style={{ fontSize: 11, color: charCount > 280 ? "#EF4444" : "#94A3B8" }}>{charCount}/300 chars</span>
          <button onClick={() => { navigator.clipboard.writeText(msg.message); setCopied(true); setTimeout(() => setCopied(false), 2000); }}
            style={{ cursor: "pointer", background: copied ? "#DCFCE7" : "#DBEAFE", color: copied ? "#166534" : "#1E40AF", border: "none", padding: "4px 10px", borderRadius: 6, fontSize: 12, fontWeight: 700 }}>
            {copied ? "âœ“" : "Copy"}
          </button>
        </div>
      </div>
      <div style={{ fontSize: 13, color: "#1E3A5F", lineHeight: 1.65 }}>{msg.message}</div>
    </Card>
  );
};

// â”€â”€â”€ RESULTS RENDERER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function RenderResults({ stageId, data }) {
  if (!data || data.error) return <div style={{ color: "#EF4444", fontSize: 13 }}>âš ï¸ {data?.error || "No data available"}</div>;
  if (data.raw) return <pre style={{ fontSize: 12, color: "#475569", whiteSpace: "pre-wrap", background: "#F8FAFC", padding: 14, borderRadius: 8 }}>{data.raw}</pre>;

  switch (stageId) {
    case "snapshot":
      return (
        <div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 16 }}>
            {[["Revenue", data.revenue], ["EBITDA", data.ebitda], ["Employees", data.employees], ["Debt Status", data.debtStatus]].map(([k, v]) => v && (
              <div key={k} style={{ background: "#F8FAFC", border: "1px solid #E2E8F0", borderRadius: 10, padding: "12px 16px" }}>
                <div style={{ fontSize: 11, color: "#94A3B8", fontWeight: 700, textTransform: "uppercase", letterSpacing: 1, marginBottom: 4 }}>{k}</div>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#0F172A" }}>{v}</div>
              </div>
            ))}
          </div>
          {data.segments && <Card><div style={{ fontSize: 12, color: "#94A3B8", fontWeight: 700, marginBottom: 6 }}>SEGMENT SPLIT</div><div style={{ fontSize: 13, color: "#374151" }}>{data.segments}</div></Card>}
          {data.legalEntities && <Card><div style={{ fontSize: 12, color: "#94A3B8", fontWeight: 700, marginBottom: 6 }}>LEGAL ENTITIES</div><div style={{ fontSize: 13, color: "#374151" }}>{data.legalEntities}</div></Card>}
          {data.recentStructure && data.recentStructure !== "None found" && <Card style={{ borderLeft: "4px solid #F59E0B", background: "#FFFBEB" }}><div style={{ fontSize: 12, color: "#92400E", fontWeight: 700, marginBottom: 6 }}>âš¡ RECENT RESTRUCTURING</div><div style={{ fontSize: 13, color: "#374151" }}>{data.recentStructure}</div></Card>}
          {data.digitalMaturity && <Card><div style={{ fontSize: 12, color: "#94A3B8", fontWeight: 700, marginBottom: 6 }}>DIGITAL MATURITY</div><div style={{ fontSize: 13, color: "#374151" }}>{data.digitalMaturity}</div></Card>}
          {data.keyFacts?.length > 0 && <Card><div style={{ fontSize: 12, color: "#94A3B8", fontWeight: 700, marginBottom: 8 }}>KEY FACTS</div>{data.keyFacts.map((f, i) => <div key={i} style={{ display: "flex", gap: 8, marginBottom: 6 }}><span style={{ color: "#3B82F6", fontWeight: 700 }}>â†’</span><span style={{ fontSize: 13, color: "#374151" }}>{f}</span></div>)}</Card>}
        </div>
      );

    case "entity":
      if (!data.exists) return <Card style={{ background: "#F8FAFC" }}><div style={{ fontSize: 14, color: "#64748B" }}>No dedicated AI/tech subsidiary found for this company. The opportunity is to engage directly with the CIO/CDO team.</div></Card>;
      return (
        <div>
          <Card style={{ borderLeft: "4px solid #8B5CF6", background: "#FAF5FF" }}>
            <div style={{ fontSize: 16, fontWeight: 800, color: "#1E293B", marginBottom: 4 }}>{data.entityName}</div>
            <div style={{ fontSize: 12, color: "#7C3AED" }}>{data.incorporated}</div>
          </Card>
          {[["CEO", data.ceo], ["CTO", data.cto], ["CIN", data.cin], ["Capital & Status", data.capitalStatus], ["Core Focus", data.coreFocus?.join(" Â· ")], ["Vendor Deals on Record", data.vendorDealsOnRecord]].map(([k, v]) => v && (
            <div key={k} style={{ display: "grid", gridTemplateColumns: "160px 1fr", gap: 12, padding: "10px 0", borderBottom: "1px solid #F1F5F9", fontSize: 13 }}>
              <span style={{ fontWeight: 700, color: "#64748B" }}>{k}</span>
              <span style={{ color: "#1E293B" }}>{v}</span>
            </div>
          ))}
          {data.urgencyNote && <Card style={{ marginTop: 14, background: "#FEF2F2", borderLeft: "4px solid #EF4444" }}><div style={{ fontSize: 12, color: "#991B1B", fontWeight: 700, marginBottom: 4 }}>âš¡ URGENCY NOTE</div><div style={{ fontSize: 13, color: "#374151" }}>{data.urgencyNote}</div></Card>}
        </div>
      );

    case "stack":
      return (
        <div>
          <div style={{ background: "#EFF6FF", border: "1px solid #BFDBFE", borderRadius: 10, padding: "12px 16px", marginBottom: 14 }}>
            <span style={{ fontWeight: 700, color: "#1E40AF" }}>Primary Cloud: </span>
            <span style={{ color: "#1E293B" }}>{data.primaryCloud}</span>
            {data.cloudDepth && <><span style={{ color: "#94A3B8", margin: "0 8px" }}>Â·</span><span style={{ color: "#475569", fontSize: 13 }}>{data.cloudDepth}</span></>}
          </div>
          <div style={{ border: "1px solid #E2E8F0", borderRadius: 10, overflow: "hidden", marginBottom: 14 }}>
            <div style={{ display: "grid", gridTemplateColumns: "160px 180px 1fr 100px", gap: 12, padding: "8px 14px", background: "#0F172A", fontSize: 11, fontWeight: 700, color: "#94A3B8", textTransform: "uppercase", letterSpacing: 1 }}>
              <div>Layer</div><div>Vendor</div><div>Use Case</div><div>Depth</div>
            </div>
            {data.stack?.map((item, i) => <StackRow key={i} item={item} i={i} />)}
          </div>
          {data.openOpportunities && <Card style={{ background: "#F0FDF4", borderLeft: "4px solid #10B981" }}><div style={{ fontSize: 12, color: "#065F46", fontWeight: 700, marginBottom: 6 }}>ğŸ¯ OPEN OPPORTUNITIES</div><div style={{ fontSize: 13, color: "#374151" }}>{data.openOpportunities}</div></Card>}
        </div>
      );

    case "stakeholders":
      return (
        <div>
          {data.entryPoint && <Card style={{ background: "#FFFBEB", borderLeft: "4px solid #F59E0B" }}><div style={{ fontSize: 12, color: "#92400E", fontWeight: 700, marginBottom: 4 }}>ğŸ¯ ENTRY POINT</div><div style={{ fontSize: 13, color: "#374151" }}>{data.entryPoint}</div></Card>}
          {data.stakeholders?.map((s, i) => (
            <Card key={i}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 }}>
                <div>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#3B82F6", textTransform: "uppercase", letterSpacing: 1, marginBottom: 3 }}>{s.role}</div>
                  <div style={{ fontSize: 15, fontWeight: 800, color: "#0F172A" }}>{s.name}</div>
                </div>
                <PriorityBadge priority={s.priority} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                <div><div style={{ fontSize: 11, color: "#94A3B8", fontWeight: 700, marginBottom: 4 }}>INFLUENCE AREA</div><div style={{ fontSize: 13, color: "#475569" }}>{s.influenceArea}</div></div>
                <div style={{ background: "#F0FDF4", borderRadius: 8, padding: "10px 12px" }}><div style={{ fontSize: 11, color: "#10B981", fontWeight: 700, marginBottom: 4 }}>HOW TO ENGAGE</div><div style={{ fontSize: 13, color: "#374151" }}>{s.howToEngage}</div></div>
              </div>
              {s.linkedIn && s.linkedIn !== "Not found" && <div style={{ marginTop: 8, fontSize: 12, color: "#3B82F6" }}>ğŸ”— {s.linkedIn}</div>}
            </Card>
          ))}
          {data.warmIntroPath && <Card style={{ background: "#EFF6FF" }}><div style={{ fontSize: 12, color: "#1E40AF", fontWeight: 700, marginBottom: 4 }}>ğŸ¤ WARM INTRO PATH</div><div style={{ fontSize: 13, color: "#374151" }}>{data.warmIntroPath}</div></Card>}
        </div>
      );

    case "signals":
      return (
        <div>
          <div style={{ background: "#0F172A", borderRadius: 10, padding: "12px 18px", marginBottom: 16, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
            <span style={{ color: "#94A3B8", fontSize: 12, fontWeight: 700 }}>OVERALL URGENCY</span>
            <PriorityBadge priority={data.overallUrgency} />
          </div>
          {data.urgencySummary && <Card style={{ borderLeft: "4px solid #EF4444", background: "#FEF2F2" }}><div style={{ fontSize: 13, color: "#374151", fontWeight: 600 }}>{data.urgencySummary}</div></Card>}
          {data.signals?.map((s, i) => <SignalCard key={i} signal={s} />)}
        </div>
      );

    case "pains":
      return (
        <div>
          {data.biggestWin && <Card style={{ borderLeft: "4px solid #10B981", background: "#F0FDF4" }}><div style={{ fontSize: 12, color: "#065F46", fontWeight: 700, marginBottom: 4 }}>ğŸ† FASTEST PATH TO A DEAL</div><div style={{ fontSize: 13, color: "#374151" }}>{data.biggestWin}</div></Card>}
          {data.pains?.map((p, i) => (
            <div key={i}>
              <div style={{ fontWeight: 800, fontSize: 15, color: "#0F172A", marginBottom: 8, paddingLeft: 4 }}>{i + 1}. {p.area}</div>
              <PainCard pain={p} />
            </div>
          ))}
          {data.pocSuggestion && <Card style={{ borderLeft: "4px solid #8B5CF6", background: "#FAF5FF" }}><div style={{ fontSize: 12, color: "#7C3AED", fontWeight: 700, marginBottom: 4 }}>ğŸ’¡ SUGGESTED POC (30 DAYS)</div><div style={{ fontSize: 13, color: "#374151" }}>{data.pocSuggestion}</div></Card>}
        </div>
      );

    case "competitive":
      return (
        <div>
          {data.biggestThreat && <Card style={{ background: "#FEF2F2", borderLeft: "4px solid #EF4444" }}><div style={{ fontSize: 12, color: "#991B1B", fontWeight: 700, marginBottom: 4 }}>âš ï¸ BIGGEST THREAT</div><div style={{ fontSize: 13, color: "#374151" }}>{data.biggestThreat}</div></Card>}
          {data.biggestAlly && <Card style={{ background: "#ECFDF5", borderLeft: "4px solid #10B981" }}><div style={{ fontSize: 12, color: "#065F46", fontWeight: 700, marginBottom: 4 }}>ğŸ¤ BEST CO-SELL ALLY</div><div style={{ fontSize: 13, color: "#374151" }}>{data.biggestAlly}</div></Card>}
          {data.competitors?.map((c, i) => (
            <Card key={i}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
                <span style={{ fontWeight: 800, fontSize: 15, color: "#0F172A" }}>{c.vendor}</span>
                <PriorityBadge priority={c.threatLevel} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                <div><div style={{ fontSize: 11, color: "#94A3B8", fontWeight: 700, marginBottom: 4 }}>CURRENT SITUATION</div><div style={{ fontSize: 13, color: "#475569" }}>{c.currentSituation}</div></div>
                <div style={{ background: "#EFF6FF", borderRadius: 8, padding: "10px 12px" }}><div style={{ fontSize: 11, color: "#3B82F6", fontWeight: 700, marginBottom: 4 }}>OUR PLAY</div><div style={{ fontSize: 13, color: "#1E293B" }}>{c.ourPlay}</div></div>
              </div>
            </Card>
          ))}
        </div>
      );

    case "action":
      return (
        <div>
          {data.weeks?.map((week, wi) => {
            const wColors = ["#10B981", "#3B82F6", "#F97316"];
            const wc = wColors[wi] || "#64748B";
            return (
              <div key={wi} style={{ marginBottom: 20 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
                  <div style={{ width: 36, height: 36, borderRadius: "50%", background: wc, display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontWeight: 900, fontSize: 16 }}>{wi + 1}</div>
                  <div><div style={{ fontWeight: 800, fontSize: 15, color: "#0F172A" }}>{week.week}</div><div style={{ fontSize: 12, color: "#64748B" }}>{week.theme}</div></div>
                </div>
                <div style={{ borderLeft: `3px solid ${wc}`, paddingLeft: 16 }}>
                  {week.actions?.map((a, ai) => (
                    <div key={ai} style={{ display: "flex", gap: 10, padding: "10px 0", borderBottom: "1px solid #F1F5F9" }}>
                      <span style={{ minWidth: 60, fontSize: 11, fontWeight: 700, color: a.priority === "MUST DO" ? "#EF4444" : "#94A3B8", background: a.priority === "MUST DO" ? "#FEE2E2" : "#F1F5F9", padding: "2px 6px", borderRadius: 4, height: "fit-content", marginTop: 1 }}>{a.priority}</span>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontSize: 13, color: "#1E293B", marginBottom: 3 }}>{a.action}</div>
                        <div style={{ fontSize: 11, color: "#94A3B8" }}>{a.owner} Â· {a.day}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
          {data.expectedOutcome && <Card style={{ background: "#ECFDF5", borderLeft: "4px solid #10B981" }}><div style={{ fontSize: 12, color: "#065F46", fontWeight: 700, marginBottom: 4 }}>EXPECTED OUTCOME BY WEEK 3</div><div style={{ fontSize: 13, color: "#374151" }}>{data.expectedOutcome}</div></Card>}
          {data.dealTimeline && <Card><div style={{ fontSize: 12, color: "#94A3B8", fontWeight: 700, marginBottom: 4 }}>DEAL TIMELINE</div><div style={{ fontSize: 14, fontWeight: 700, color: "#0F172A" }}>{data.dealTimeline}</div></Card>}
        </div>
      );

    case "outreach":
      return (
        <div>
          {data.coldCallOpener && (
            <Card style={{ background: "#0F172A", border: "1px solid #1E293B" }}>
              <div style={{ fontSize: 11, color: "#64748B", fontWeight: 700, marginBottom: 8, textTransform: "uppercase", letterSpacing: 1 }}>ğŸ“ Cold Call Opener</div>
              <div style={{ fontSize: 15, color: "#F8FAFC", fontWeight: 600, lineHeight: 1.6, fontStyle: "italic" }}>"{data.coldCallOpener}"</div>
            </Card>
          )}
          {data.emails?.length > 0 && (
            <div>
              <div style={{ fontSize: 12, fontWeight: 700, color: "#64748B", textTransform: "uppercase", letterSpacing: 1, margin: "16px 0 10px" }}>ğŸ“§ Email Templates</div>
              {data.emails.map((e, i) => <EmailCard key={i} email={e} />)}
            </div>
          )}
          {data.linkedInMessages?.length > 0 && (
            <div>
              <div style={{ fontSize: 12, fontWeight: 700, color: "#1E40AF", textTransform: "uppercase", letterSpacing: 1, margin: "16px 0 10px" }}>ğŸ”— LinkedIn Messages</div>
              {data.linkedInMessages.map((m, i) => <LinkedInCard key={i} msg={m} />)}
            </div>
          )}
        </div>
      );

    default:
      return <pre style={{ fontSize: 12, whiteSpace: "pre-wrap" }}>{JSON.stringify(data, null, 2)}</pre>;
  }
}

// â”€â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export default function App() {
  const [company, setCompany] = useState("");
  const [url, setUrl] = useState("");
  const [running, setRunning] = useState(false);
  const [activeStage, setActiveStage] = useState(null);
  const [stageStatus, setStageStatus] = useState({});
  const [stageData, setStageData] = useState({});
  const [selectedSection, setSelectedSection] = useState(null);
  const [done, setDone] = useState(false);
  const [error, setError] = useState(null);
  const abortRef = useRef(false);

  const getContext = (data) => {
    const summary = {};
    if (data.snapshot) summary.company = { revenue: data.snapshot.revenue, segments: data.snapshot.segments };
    if (data.signals) summary.topSignals = data.signals.signals?.slice(0, 3).map(s => s.signal);
    if (data.pains) summary.topPains = data.pains.pains?.slice(0, 3).map(p => p.area);
    return JSON.stringify(summary);
  };

  const runResearch = async () => {
    if (!company.trim()) return;
    abortRef.current = false;
    setRunning(true);
    setDone(false);
    setError(null);
    setStageStatus({});
    setStageData({});
    setSelectedSection(null);

    const collected = {};

    for (const stage of STAGES) {
      if (abortRef.current) break;
      setActiveStage(stage.id);
      setStageStatus(prev => ({ ...prev, [stage.id]: "running" }));
      setSelectedSection(stage.id);

      try {
        const prevContext = ["action", "outreach"].includes(stage.id) ? getContext(collected) : "";
        const prompt = STAGE_PROMPTS[stage.id](company, url || company + " company", prevContext);
        const result = await callClaude(prompt, "");
        collected[stage.id] = result;
        setStageData(prev => ({ ...prev, [stage.id]: result }));
        setStageStatus(prev => ({ ...prev, [stage.id]: "done" }));
      } catch (err) {
        setStageStatus(prev => ({ ...prev, [stage.id]: "error" }));
        setStageData(prev => ({ ...prev, [stage.id]: { error: err.message } }));
      }
    }

    setActiveStage(null);
    setRunning(false);
    setDone(true);
  };

  const stop = () => { abortRef.current = true; };

  const completedCount = Object.values(stageStatus).filter(s => s === "done").length;

  return (
    <div style={{ fontFamily: "'DM Sans', 'Segoe UI', sans-serif", background: "#F8FAFC", minHeight: "100vh", display: "flex", flexDirection: "column" }}>

      {/* Header */}
      <div style={{ background: "#0F172A", padding: "0 24px", borderBottom: "1px solid #1E293B", display: "flex", alignItems: "center", justifyContent: "space-between", height: 56, flexShrink: 0 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <div style={{ width: 28, height: 28, background: "linear-gradient(135deg, #3B82F6, #8B5CF6)", borderRadius: 8, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 14 }}>ğŸ¯</div>
          <span style={{ color: "#F8FAFC", fontWeight: 800, fontSize: 15, letterSpacing: -0.3 }}>ABM Research Engine</span>
          <span style={{ color: "#475569", fontSize: 12 }}>Younion Ã— AWS</span>
        </div>
        {running && (
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <div style={{ width: 8, height: 8, borderRadius: "50%", background: "#10B981", animation: "pulse 1.5s infinite" }} />
            <span style={{ color: "#94A3B8", fontSize: 12 }}>{completedCount}/{STAGES.length} sections complete</span>
            <button onClick={stop} style={{ cursor: "pointer", background: "#DC2626", color: "#fff", border: "none", padding: "4px 12px", borderRadius: 6, fontSize: 12, fontWeight: 700 }}>Stop</button>
          </div>
        )}
        {done && <span style={{ color: "#10B981", fontSize: 13, fontWeight: 700 }}>âœ“ Profile complete â€” {company}</span>}
      </div>

      <div style={{ display: "flex", flex: 1, overflow: "hidden" }}>

        {/* Left sidebar */}
        <div style={{ width: 260, background: "#FFFFFF", borderRight: "1px solid #E2E8F0", display: "flex", flexDirection: "column", flexShrink: 0 }}>

          {/* Input area */}
          <div style={{ padding: 20, borderBottom: "1px solid #E2E8F0" }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: "#94A3B8", textTransform: "uppercase", letterSpacing: 1, marginBottom: 12 }}>New Account</div>
            <input
              value={company}
              onChange={e => setCompany(e.target.value)}
              placeholder="Company name"
              disabled={running}
              style={{ width: "100%", padding: "8px 12px", border: "1px solid #E2E8F0", borderRadius: 8, fontSize: 13, marginBottom: 8, outline: "none", boxSizing: "border-box", background: running ? "#F8FAFC" : "#FFF" }}
            />
            <input
              value={url}
              onChange={e => setUrl(e.target.value)}
              placeholder="Website URL (optional)"
              disabled={running}
              style={{ width: "100%", padding: "8px 12px", border: "1px solid #E2E8F0", borderRadius: 8, fontSize: 13, marginBottom: 12, outline: "none", boxSizing: "border-box", background: running ? "#F8FAFC" : "#FFF" }}
            />
            <button
              onClick={running ? stop : runResearch}
              disabled={!company.trim() && !running}
              style={{
                width: "100%", padding: "10px 0", borderRadius: 8, border: "none",
                background: running ? "#DC2626" : (!company.trim() ? "#E2E8F0" : "linear-gradient(135deg, #3B82F6, #6366F1)"),
                color: !company.trim() && !running ? "#94A3B8" : "#FFFFFF",
                fontWeight: 800, fontSize: 14, cursor: company.trim() || running ? "pointer" : "not-allowed",
                transition: "all 0.2s"
              }}
            >
              {running ? "â¹ Stop Research" : "â–¶ Generate Profile"}
            </button>
          </div>

          {/* Stage nav */}
          <div style={{ flex: 1, overflowY: "auto", padding: "12px 8px" }}>
            {STAGES.map(stage => {
              const status = stageStatus[stage.id];
              const isActive = activeStage === stage.id;
              const isSelected = selectedSection === stage.id;
              return (
                <button
                  key={stage.id}
                  onClick={() => stageData[stage.id] && setSelectedSection(stage.id)}
                  style={{
                    width: "100%", display: "flex", alignItems: "center", gap: 10,
                    padding: "9px 12px", borderRadius: 8, border: "none",
                    background: isSelected ? stage.color + "15" : "transparent",
                    cursor: stageData[stage.id] ? "pointer" : "default",
                    marginBottom: 2, textAlign: "left", transition: "background 0.15s"
                  }}
                >
                  <span style={{ fontSize: 15, minWidth: 22 }}>{stage.icon}</span>
                  <span style={{ fontSize: 13, fontWeight: isSelected ? 700 : 500, color: isSelected ? stage.color : status === "done" ? "#1E293B" : "#94A3B8", flex: 1 }}>
                    {stage.label}
                  </span>
                  {isActive && <div style={{ width: 16, height: 16, border: `2px solid ${stage.color}`, borderTopColor: "transparent", borderRadius: "50%", animation: "spin 0.8s linear infinite" }} />}
                  {status === "done" && !isActive && <span style={{ color: "#10B981", fontSize: 14 }}>âœ“</span>}
                  {status === "error" && <span style={{ color: "#EF4444", fontSize: 14 }}>âœ—</span>}
                </button>
              );
            })}
          </div>

          {/* Progress bar */}
          {(running || done) && (
            <div style={{ padding: "12px 16px", borderTop: "1px solid #E2E8F0" }}>
              <div style={{ height: 4, background: "#E2E8F0", borderRadius: 9999, overflow: "hidden" }}>
                <div style={{ height: "100%", width: `${(completedCount / STAGES.length) * 100}%`, background: "linear-gradient(90deg, #3B82F6, #10B981)", transition: "width 0.4s ease", borderRadius: 9999 }} />
              </div>
              <div style={{ fontSize: 11, color: "#94A3B8", marginTop: 6, textAlign: "center" }}>{completedCount}/{STAGES.length} sections</div>
            </div>
          )}
        </div>

        {/* Main content */}
        <div style={{ flex: 1, overflowY: "auto", padding: 28 }}>

          {/* Empty state */}
          {!running && !done && (
            <div style={{ display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", height: "100%", textAlign: "center", color: "#94A3B8" }}>
              <div style={{ fontSize: 56, marginBottom: 20 }}>ğŸ¯</div>
              <div style={{ fontSize: 22, fontWeight: 800, color: "#1E293B", marginBottom: 8 }}>ABM Research Engine</div>
              <div style={{ fontSize: 15, color: "#64748B", maxWidth: 420, lineHeight: 1.7 }}>
                Enter a company name and website URL, then click Generate Profile. The engine will research all 9 sections automatically using live web data.
              </div>
              <div style={{ marginTop: 28, display: "flex", gap: 10, flexWrap: "wrap", justifyContent: "center" }}>
                {["Account Snapshot", "Tech Stack", "Buying Signals", "Business Pains", "Outreach Emails"].map(s => (
                  <span key={s} style={{ background: "#EFF6FF", color: "#3B82F6", padding: "6px 14px", borderRadius: 20, fontSize: 12, fontWeight: 600 }}>{s}</span>
                ))}
              </div>
            </div>
          )}

          {/* Active loading state with no section selected */}
          {running && !selectedSection && (
            <div style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "100%" }}>
              <div style={{ textAlign: "center" }}>
                <div style={{ width: 48, height: 48, border: "4px solid #E2E8F0", borderTopColor: "#3B82F6", borderRadius: "50%", animation: "spin 0.8s linear infinite", margin: "0 auto 16px" }} />
                <div style={{ fontSize: 15, color: "#64748B" }}>Researching {company}â€¦</div>
              </div>
            </div>
          )}

          {/* Section content */}
          {selectedSection && (
            <div>
              {(() => {
                const stage = STAGES.find(s => s.id === selectedSection);
                const status = stageStatus[selectedSection];
                const data = stageData[selectedSection];
                return (
                  <>
                    <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 24 }}>
                      <div style={{ width: 44, height: 44, background: stage.color + "18", borderRadius: 12, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22 }}>{stage.icon}</div>
                      <div>
                        <div style={{ fontSize: 20, fontWeight: 900, color: "#0F172A" }}>{stage.label}</div>
                        <div style={{ fontSize: 13, color: "#64748B" }}>{company}{url ? ` Â· ${url}` : ""}</div>
                      </div>
                      {status === "running" && (
                        <div style={{ marginLeft: "auto", display: "flex", alignItems: "center", gap: 8 }}>
                          <div style={{ width: 16, height: 16, border: `2px solid ${stage.color}`, borderTopColor: "transparent", borderRadius: "50%", animation: "spin 0.8s linear infinite" }} />
                          <span style={{ fontSize: 13, color: stage.color, fontWeight: 600 }}>Researchingâ€¦</span>
                        </div>
                      )}
                      {status === "done" && <span style={{ marginLeft: "auto", fontSize: 13, color: "#10B981", fontWeight: 700 }}>âœ“ Complete</span>}
                    </div>
                    {status === "running" && !data && (
                      <div style={{ display: "flex", gap: 10, flexDirection: "column" }}>
                        {[100, 80, 90, 70].map((w, i) => (
                          <div key={i} style={{ height: 20, background: "#E2E8F0", borderRadius: 6, width: w + "%", animation: "pulse 1.5s infinite", animationDelay: i * 0.1 + "s" }} />
                        ))}
                      </div>
                    )}
                    {data && <RenderResults stageId={selectedSection} data={data} />}
                  </>
                );
              })()}
            </div>
          )}
        </div>
      </div>

      <style>{`
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        * { box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
        input:focus { border-color: #3B82F6 !important; box-shadow: 0 0 0 3px #3B82F620; }
      `}</style>
    </div>
  );
}
    // Make sure your last line renders the app, like:
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
